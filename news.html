<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>News Details</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="d-flex flex-column min-vh-100">
    <nav class="navbar navbar-dark bg-dark px-3">
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <img src="./QKSS-logo.jpg.png" alt="QKSS-logo" height="40" />
      </a>
      <div class="ms-auto d-flex align-items-center gap-2">
        <div class="nav-item dropdown">
          <a
            class="nav-link dropdown-toggle text-light"
            href="#"
            id="langDropdown"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <i class="bi bi-translate"></i>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="langDropdown">
            <li><button class="dropdown-item lang-option" data-lang="en">English</button></li>
            <li><button class="dropdown-item lang-option" data-lang="sq">Shqip</button></li>
            <li><button class="dropdown-item lang-option" data-lang="sr">Srpski</button></li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="flex-grow-1 container py-4" id="content">
      <h2 id="newsTitle" class="mb-3"></h2>
      <p id="newsDescription"></p>
      <p>
        <strong>Coordinates:</strong> <span id="newsCoords"></span><br />
        <strong>Category:</strong> <span id="newsCategory"></span>
      </p>
      <p>
        <a id="externalLink" href="#" target="_blank" class="btn btn-primary">Open Original Article</a>
        <a href="index.html" class="btn btn-secondary ms-2">&larr; Back to Map</a>
      </p>
    </main>

    <footer class="bg-dark text-light text-center py-2 mt-auto">
      <small>© 2025 QKSS Map Viewer. Data sourced from our API.</small>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="config.js"></script>
    <script>
      function getLang() {
        return localStorage.getItem("lang") || "en";
      }
      function setLang(lang) {
        localStorage.setItem("lang", lang);
        updateLangDropdownDisplay();
        loadNews();
      }
      const LANG_LABELS = { en: "English", sq: "Shqip", sr: "Srpski" };
      const UI_STRINGS = {
        en: {
          externalLink: "Open Original Article",
          back: "\u2190 Back to Map",
          coordsLabel: "Coordinates:",
          categoryLabel: "Category:",
        },
        sq: {
          externalLink: "Hape Artikullin",
          back: "\u2190 Kthehu te Harta",
          coordsLabel: "Koordinatat:",
          categoryLabel: "Kategoria:",
        },
        sr: {
          externalLink: "Otvorite Članak",
          back: "\u2190 Nazad na mapu",
          coordsLabel: "Koordinate:",
          categoryLabel: "Kategorija:",
        },
      };
      function updateLangDropdownDisplay() {
        const current = getLang();
        const toggle = document.getElementById("langDropdown");
        toggle.innerHTML = `<i class="bi bi-translate"></i> ${LANG_LABELS[current]}`;
      }
      document.querySelectorAll(".lang-option").forEach((btn) => {
        btn.addEventListener("click", () => setLang(btn.dataset.lang));
      });
      updateLangDropdownDisplay();

      async function loadNews() {
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");
        if (!id) return;
        try {
          const res = await fetch(`${API_BASE_URL}/pins/${id}`);
          if (!res.ok) throw new Error("Failed to load news");
          const pin = await res.json();
          const lang = getLang();
          const title = (pin.title && pin.title[lang]) || pin.title?.en || pin.title || "";
          const desc = (pin.description && pin.description[lang]) || pin.description?.en || pin.description || "";
          document.getElementById("newsTitle").textContent = title;
          document.getElementById("newsDescription").textContent = desc;
          document.getElementById("newsCoords").textContent = `${pin.lat}, ${pin.lng}`;
          document.getElementById("newsCategory").textContent = pin.category || "N/A";
          const u = UI_STRINGS[getLang()];
          document.getElementById("externalLink").textContent = u.externalLink;
          document.getElementById("externalLink").href = pin.articleUrl || "#";
          document.querySelector("a.btn-secondary").textContent = u.back;
          document.querySelector("#newsCoords").previousSibling.textContent = `${u.coordsLabel} `;
          document.querySelector("#newsCategory").previousSibling.textContent = `${u.categoryLabel} `;
        } catch (err) {
          document.getElementById("content").innerHTML = `<div class="alert alert-danger">Unable to load news.</div>`;
        }
      }
      window.addEventListener("DOMContentLoaded", loadNews);
    </script>
  </body>
</html>
