<VirtualHost *:80>
  ServerName imap.qkss.org
  # Redirect all HTTP â†’ HTTPS
  RewriteEngine On
  RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [L,NE,R=permanent]
</VirtualHost>

<VirtualHost *:443>
  ServerName imap.qkss.org

  # SSL Certificate (from Let's Encrypt or your CA)
  SSLEngine on
  SSLCertificateFile    /etc/letsencrypt/live/imap.qkss.org/fullchain.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/imap.qkss.org/privkey.pem

  # Serve your static files
  DocumentRoot /var/www/html
  <Directory /var/www/html>
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
  </Directory>

  # Reverse-proxy /api to backend
  ProxyPreserveHost On
  ProxyRequests Off
  <Location /api/>
    ProxyPass        http://49.12.75.177:8082/api/
    ProxyPassReverse http://49.12.75.177:8082/api/
    # optional: adjust WebSocket/CORS headers if needed
    RequestHeader    set X-Forwarded-Proto "https"
  </Location>

  # Fallback for SPA (if you need it)
  <IfModule mod_dir.c>
    DirectoryIndex index.html
  </IfModule>
  <Location />
    # serve index.html for any path not matching a real file
    ErrorDocument 404 /index.html
  </Location>

  # Security headers (optional but recommended)
  Header always set X-Frame-Options DENY
  Header always set X-Content-Type-Options nosniff
  Header always set Referrer-Policy "no-referrer-when-downgrade"
</VirtualHost>
