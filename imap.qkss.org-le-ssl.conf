<IfModule mod_ssl.c>
<VirtualHost *:443>
  ServerName imap.qkss.org

  SSLEngine on
  SSLCertificateFile    /etc/letsencrypt/live/imap.qkss.org/fullchain.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/imap.qkss.org/privkey.pem

  DocumentRoot /var/www/html
  <Directory /var/www/html>
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
  </Directory>

  # 1) Proxy all /api/* to your backend
  ProxyPreserveHost On
  ProxyPass        /api/ http://49.12.75.177:8082/api/
  ProxyPassReverse /api/ http://49.12.75.177:8082/api/

  # 2) SPA Fallback: ONLY for non-/api and non-file requests
  <IfModule mod_rewrite.c>
    RewriteEngine On
    # skip if URI starts with /api/
    RewriteCond %{REQUEST_URI} !^/api/ [NC]
    # skip if it matches a real file
    RewriteCond %{REQUEST_FILENAME} !-f
    # everything else goes to index.html
    RewriteRule ^ /index.html [L]
  </IfModule>

  # Optional security headers
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
  Header always set X-Frame-Options DENY
  Header always set X-Content-Type-Options nosniff

</VirtualHost>
</IfModule>
