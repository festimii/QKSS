<IfModule mod_ssl.c>
<VirtualHost *:443>
  ServerName imap.qkss.org

  # SSL Certs from Let's Encrypt
  SSLEngine on
  SSLCertificateFile    /etc/letsencrypt/live/imap.qkss.org/fullchain.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/imap.qkss.org/privkey.pem

  DocumentRoot /var/www/html

  # 1) Proxy all /api/* to your Spring Boot backend
  ProxyPreserveHost On
  ProxyPass        /api/  http://49.12.75.177:8082/api/
  ProxyPassReverse /api/  http://49.12.75.177:8082/api/

  # 2) Serve existing static files & directories automatically,
  #    skip proxy and fallback for these.
  <Directory /var/www/html>
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted

    RewriteEngine On
    # If the request is for an existing file or folder, stop rewriting
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # 3) Otherwise, fallback to index.html (SPA entrypoint)
    RewriteRule ^ /index.html [L]
  </Directory>

  # HSTS & security headers (optional but recommended)
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
  Header always set X-Frame-Options DENY
  Header always set X-Content-Type-Options nosniff
</VirtualHost>
</IfModule>
